<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Carrinho de Compras - WebStyle</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* HEADER */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 20px 0;
            margin-bottom: 30px;
            border-radius: 15px;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
        }

        .logo-icon {
            font-size: 36px;
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-name {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-slogan {
            font-size: 10px;
            color: #666;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .btn-back {
            padding: 10px 25px;
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
        }

        .btn-back:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(107, 114, 128, 0.4);
        }

        /* CONTAINER PRINCIPAL */
        .cart-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .page-title {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .page-title h1 {
            font-size: 42px;
            font-weight: 800;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .page-title p {
            font-size: 16px;
            opacity: 0.9;
        }

        /* MENSAGENS */
        .alert {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.95);
            color: white;
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.95);
            color: white;
        }

        /* CARRINHO VAZIO */
        .empty-cart {
            background: white;
            padding: 80px 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .empty-cart-icon {
            font-size: 100px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-cart h2 {
            font-size: 32px;
            color: #1f2937;
            margin-bottom: 15px;
        }

        .empty-cart p {
            font-size: 18px;
            color: #6b7280;
            margin-bottom: 30px;
        }

        .btn-continue {
            display: inline-block;
            padding: 15px 35px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 30px;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-continue:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        /* GRID DO CARRINHO */
        .cart-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            align-items: start;
        }

        /* LISTA DE ITENS */
        .cart-items {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .cart-items h2 {
            font-size: 24px;
            color: #1f2937;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .cart-item {
            display: flex;
            gap: 20px;
            padding: 20px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .item-image {
            width: 120px;
            height: 120px;
            border-radius: 12px;
            overflow: hidden;
            background: #f3f4f6;
            flex-shrink: 0;
        }

        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .no-item-image {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: #9ca3af;
        }

        .item-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .item-name {
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
        }

        .item-code {
            font-size: 12px;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .item-price {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
        }

        .item-actions {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .qty-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 6px;
            background: #667eea;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .qty-btn:hover {
            background: #764ba2;
            transform: scale(1.1);
        }

        .qty-input {
            width: 50px;
            height: 32px;
            text-align: center;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-weight: bold;
            color: #1f2937;
        }

        .btn-remove {
            padding: 8px 16px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .btn-remove:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .item-subtotal {
            text-align: right;
            margin-top: 10px;
        }

        .subtotal-label {
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
        }

        .subtotal-value {
            font-size: 18px;
            font-weight: 700;
            color: #10b981;
        }

        /* RESUMO DO CARRINHO */
        .cart-summary {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: sticky;
            top: 20px;
        }

        .cart-summary h2 {
            font-size: 24px;
            color: #1f2937;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        /* SE√á√ÉO DE ENDERE√áOS */
        .address-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .address-title {
            font-size: 16px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-add-address {
            width: 100%;
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            margin-bottom: 15px;
        }

        .btn-add-address:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5);
        }

        .address-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }

        /* Scrollbar customizada */
        .address-list::-webkit-scrollbar {
            width: 6px;
        }

        .address-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .address-list::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        .address-list::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        .address-item {
            position: relative;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .address-item:hover {
            border-color: #667eea;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .address-item.selected {
            border-color: #10b981;
            background: #d1fae5;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .address-item input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .address-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .checkbox-icon {
            width: 24px;
            height: 24px;
            border: 2px solid #d1d5db;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            margin-top: 2px;
        }

        .address-item.selected .checkbox-icon {
            border-color: #10b981;
            background: #10b981;
        }

        .checkbox-icon::after {
            content: '‚úì';
            color: white;
            font-size: 14px;
            font-weight: bold;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s;
        }

        .address-item.selected .checkbox-icon::after {
            opacity: 1;
            transform: scale(1);
        }

        .address-content {
            flex: 1;
        }

        .address-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .address-apelido {
            font-size: 16px;
            font-weight: 700;
            color: #1f2937;
        }

        .address-badge {
            background: #667eea;
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .address-badge.default {
            background: #10b981;
        }

        .address-details {
            color: #4b5563;
            font-size: 13px;
            line-height: 1.6;
        }

        .no-address {
            text-align: center;
            padding: 30px 20px;
            background: #fff3cd;
            border: 2px dashed #ffc107;
            border-radius: 10px;
            color: #856404;
        }

        .no-address-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .no-address p {
            margin: 5px 0;
            font-size: 14px;
        }

        .no-address a {
            color: #667eea;
            font-weight: 700;
            text-decoration: none;
        }

        .no-address a:hover {
            text-decoration: underline;
        }

        /* SE√á√ÉO DE FRETE */
        .shipping-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .shipping-title {
            font-size: 16px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .shipping-info {
            background: #e0e7ff;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 13px;
            color: #1f2937;
        }

        .shipping-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .shipping-option {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .shipping-option:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }

        .shipping-option.selected {
            border-color: #10b981;
            background: #d1fae5;
        }

        .shipping-option-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .shipping-name {
            font-weight: 700;
            color: #1f2937;
            font-size: 15px;
        }

        .shipping-price {
            font-weight: 700;
            color: #10b981;
            font-size: 16px;
        }

        .shipping-price.free {
            color: #059669;
        }

        .shipping-details {
            font-size: 12px;
            color: #6b7280;
            display: flex;
            justify-content: space-between;
        }

        .free-badge {
            background: #10b981;
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .summary-label {
            font-size: 16px;
            color: #6b7280;
        }

        .summary-value {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
        }

        .summary-total {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
        }

        .total-label {
            font-size: 20px;
            font-weight: 700;
            color: #1f2937;
        }

        .total-value {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .summary-actions {
            margin-top: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .btn-checkout {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-checkout:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(16, 185, 129, 0.6);
        }

        .btn-checkout:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .btn-clear {
            width: 100%;
            padding: 12px;
            background: white;
            color: #ef4444;
            border: 2px solid #ef4444;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .btn-clear:hover {
            background: #ef4444;
            color: white;
        }

        /* ==================== MODAL ==================== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
            position: relative;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Scrollbar customizada para o modal */
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .modal-title {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-close {
            background: #ef4444;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            line-height: 1;
        }

        .modal-close:hover {
            background: #dc2626;
            transform: rotate(90deg);
        }

        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 700;
            color: #1f2937;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-label.required::after {
            content: ' *';
            color: #ef4444;
        }

        .form-input {
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-input.error {
            border-color: #ef4444;
        }

        .form-error {
            color: #ef4444;
            font-size: 12px;
            font-weight: 600;
            display: none;
        }

        .form-error.active {
            display: block;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-submit {
            flex: 1;
            padding: 15px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-submit:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(16, 185, 129, 0.6);
        }

        .btn-submit:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .btn-cancel {
            flex: 1;
            padding: 15px;
            background: white;
            color: #6b7280;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-cancel:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }

        .cep-group {
            position: relative;
        }

        .btn-buscar-cep {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            padding: 8px 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-buscar-cep:hover {
            background: #764ba2;
        }

        .loading {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* ==================== ESTILOS DE PAGAMENTO ==================== */
        .payment-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .payment-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .payment-option:hover {
            border-color: #667eea;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .payment-icon {
            font-size: 32px;
            width: 50px;
            text-align: center;
        }

        .payment-info {
            flex: 1;
        }

        .payment-name {
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .payment-desc {
            font-size: 14px;
            color: #6b7280;
        }

        .payment-arrow {
            font-size: 20px;
            color: #9ca3af;
            transition: all 0.3s;
        }

        .payment-option:hover .payment-arrow {
            color: #667eea;
            transform: translateX(5px);
        }

        .payment-error {
            display: none;
        }

        .payment-error.active {
            display: block;
        }

        .payment-input.error {
            border-color: #ef4444;
        }

        /* ==================== ESTILOS DE BOLETO ==================== */
        .boleto-info {
            text-align: center;
            padding: 30px 20px;
            background: #f0f9ff;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .boleto-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .boleto-text h3 {
            font-size: 24px;
            color: #1f2937;
            margin-bottom: 10px;
        }

        .boleto-text p {
            color: #6b7280;
            margin-bottom: 8px;
        }

        /* ==================== ESTILOS DE RESUMO ==================== */
        .resumo-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .resumo-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
        }

        .resumo-section h3 {
            font-size: 16px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .resumo-info {
            color: #4b5563;
            line-height: 1.6;
        }

        .resumo-valores {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .resumo-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .resumo-row.total {
            border-top: 2px solid #e5e7eb;
            margin-top: 8px;
            padding-top: 15px;
            font-weight: 700;
            font-size: 18px;
            color: #1f2937;
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }

            to {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
        }

        /* RESPONSIVO */
        @media (max-width: 1024px) {
            .cart-grid {
                grid-template-columns: 1fr;
            }

            .cart-summary {
                position: static;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .page-title h1 {
                font-size: 32px;
            }

            .cart-item {
                flex-direction: column;
            }

            .item-image {
                width: 100%;
                height: 200px;
            }

            .item-actions {
                flex-wrap: wrap;
            }

            .address-list {
                max-height: none;
            }

            .modal-content {
                padding: 30px 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- HEADER -->
    <div class="header">
        <div class="header-content">
            <a href="/home" class="logo">
                <div class="logo-icon">üëî</div>
                <div class="logo-text">
                    <span class="logo-name">WebStyle</span>
                    <span class="logo-slogan">Loja de Roupas</span>
                </div>
            </a>
            <a href="/home" class="btn-back">‚Üê Continuar Comprando</a>
        </div>
    </div>

    <!-- CONTAINER PRINCIPAL -->
    <div class="cart-container">
        <!-- T√çTULO -->
        <div class="page-title">
            <h1>üõí Meu Carrinho</h1>
            <p th:if="${!isEmpty}">Voc√™ tem <strong th:text="${cartItemCount}">0</strong> item(ns) no carrinho</p>
        </div>

        <!-- MENSAGENS -->
        <div th:if="${sucesso}" class="alert alert-success" th:text="${sucesso}"></div>
        <div th:if="${erro}" class="alert alert-error" th:text="${erro}"></div>

        <!-- CARRINHO VAZIO -->
        <div th:if="${isEmpty}" class="empty-cart">
            <div class="empty-cart-icon">üõçÔ∏è</div>
            <h2>Seu carrinho est√° vazio</h2>
            <p>Adicione produtos incr√≠veis ao seu carrinho e comece suas compras!</p>
            <a href="/home" class="btn-continue">üè† Ir √†s Compras</a>
        </div>

        <!-- CARRINHO COM ITENS -->
        <div th:unless="${isEmpty}" class="cart-grid">
            <!-- LISTA DE ITENS -->
            <div class="cart-items">
                <h2>üì¶ Itens do Carrinho</h2>

                <div class="cart-item" th:each="item : ${cartItems}">
                    <div class="item-image">
                        <img th:if="${item.imagemPrincipal != null}" th:src="@{/{path}(path=${item.imagemPrincipal})}"
                            th:alt="${item.nome}">
                        <div th:unless="${item.imagemPrincipal != null}" class="no-item-image">üì∑</div>
                    </div>

                    <div class="item-details">
                        <div class="item-name" th:text="${item.nome}">Nome do Produto</div>
                        <div class="item-code" th:text="'C√≥d: ' + ${item.codigo}">C√≥d: XXXXX</div>
                        <div class="item-price">
                            R$ <span th:text="${#numbers.formatDecimal(item.preco, 1, 2)}">0,00</span>
                        </div>

                        <div class="item-actions">
                            <form th:action="@{/carrinho/atualizar}" method="post" style="display: inline;">
                                <input type="hidden" name="produtoId" th:value="${item.produtoId}">
                                <div class="quantity-controls">
                                    <button type="button" class="qty-btn"
                                        th:onclick="'decrementQty(' + ${item.produtoId} + ')'">‚àí</button>
                                    <input type="number" class="qty-input" th:id="'qty-' + ${item.produtoId}"
                                        name="quantidade" th:value="${item.quantidade}" min="1" readonly>
                                    <button type="button" class="qty-btn"
                                        th:onclick="'incrementQty(' + ${item.produtoId} + ')'">+</button>
                                    <button type="submit" style="display: none;"
                                        th:id="'btnUpdate-' + ${item.produtoId}">Atualizar</button>
                                </div>
                            </form>

                            <form th:action="@{/carrinho/remover}" method="post" style="display: inline;">
                                <input type="hidden" name="produtoId" th:value="${item.produtoId}">
                                <button type="submit" class="btn-remove"
                                    onclick="return confirm('Deseja remover este item do carrinho?')">
                                    üóëÔ∏è Remover
                                </button>
                            </form>
                        </div>

                        <div class="item-subtotal">
                            <div class="subtotal-label">Subtotal</div>
                            <div class="subtotal-value">
                                R$ <span th:text="${#numbers.formatDecimal(item.subtotal, 1, 2)}">0,00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RESUMO DO CARRINHO -->
            <div class="cart-summary">
                <h2>üí∞ Resumo do Pedido</h2>

                <!-- SE√á√ÉO DE ENDERE√áOS -->
                <div class="address-section">
                    <div class="address-title">
                        üìç Selecione o Endere√ßo de Entrega
                    </div>

                    <!-- Bot√£o Adicionar Novo Endere√ßo -->
                    <div th:if="${session.clienteLogado != null}">
                        <button type="button" class="btn-add-address" onclick="abrirModalEndereco()">
                            ‚ûï Adicionar Novo Endere√ßo
                        </button>
                    </div>

                    <!-- Lista de endere√ßos (se cliente estiver logado) -->
                    <div th:if="${session.clienteLogado != null and session.clienteLogado.enderecosEntrega != null and !session.clienteLogado.enderecosEntrega.isEmpty()}"
                        class="address-list">
                        <div class="address-item"
                            th:each="endereco : ${session.clienteLogado.enderecosEntrega}"
                            th:data-endereco-id="${endereco.id}"
                            th:classappend="${endereco.enderecoPadrao} ? 'selected' : ''"
                            onclick="selecionarEndereco(this)">
                            <input type="radio" name="enderecoSelecionado" th:value="${endereco.id}"
                                th:checked="${endereco.enderecoPadrao}">
                            <div class="address-checkbox">
                                <div class="checkbox-icon"></div>
                                <div class="address-content">
                                    <div class="address-header">
                                        <span class="address-apelido" th:text="${endereco.apelido}">Apelido</span>
                                        <span th:if="${endereco.enderecoPadrao}"
                                            class="address-badge default">Padr√£o</span>
                                    </div>
                                    <div class="address-details">
                                        <span th:text="${endereco.logradouro}">Logradouro</span>,
                                        <span th:text="${endereco.numero}">123</span>
                                        <span th:if="${endereco.complemento}"
                                            th:text="' - ' + ${endereco.complemento}"></span>
                                        <br>
                                        <span th:text="${endereco.bairro}">Bairro</span> -
                                        <span th:text="${endereco.cidade}">Cidade</span>/<span
                                            th:text="${endereco.estado}">UF</span>
                                        <br>
                                        CEP: <span
                                            th:text="${#strings.substring(endereco.cep, 0, 5) + '-' + #strings.substring(endereco.cep, 5, 8)}">00000-000</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sem endere√ßos cadastrados -->
                    <div th:if="${session.clienteLogado == null or session.clienteLogado.enderecosEntrega == null or session.clienteLogado.enderecosEntrega.isEmpty()}"
                        class="no-address">
                        <div class="no-address-icon">üìç</div>
                        <p><strong>Nenhum endere√ßo cadastrado</strong></p>
                        <p th:if="${session.clienteLogado != null}">
                            Clique em "Adicionar Novo Endere√ßo" acima para cadastrar
                        </p>
                        <p th:unless="${session.clienteLogado != null}">
                            <a href="/cliente/login">Fa√ßa login</a> para selecionar um endere√ßo
                        </p>
                    </div>
                </div>

                <!-- SE√á√ÉO DE FRETE -->
                <div class="shipping-section" id="shippingSection" style="display: none;">
                    <div class="shipping-title">
                        üöö Op√ß√µes de Frete
                    </div>

                    <div id="shippingInfo" class="shipping-info" style="display: none;"></div>
                    <div id="shippingOptions" class="shipping-options"></div>
                </div>

                <div class="summary-row">
                    <span class="summary-label">Subtotal (<span th:text="${cartItemCount}">0</span> itens):</span>
                    <span class="summary-value" id="subtotalValue">R$ <span
                            th:text="${#numbers.formatDecimal(cartTotal, 1, 2)}">0,00</span></span>
                </div>

                <div class="summary-row" id="freteRow" style="display: none;">
                    <span class="summary-label">Frete:</span>
                    <span class="summary-value" id="freteValue">R$ 0,00</span>
                </div>

                <div class="summary-row summary-total">
                    <span class="total-label">Total:</span>
                    <span class="total-value" id="totalValue">R$ <span
                            th:text="${#numbers.formatDecimal(cartTotal, 1, 2)}">0,00</span></span>
                </div>

                <div class="summary-actions">
                    <button type="button" class="btn-checkout" id="btnCheckout" onclick="finalizarCompra()">
                        ‚úÖ Finalizar Compra
                    </button>

                    <form th:action="@{/carrinho/limpar}" method="post">
                        <button type="submit" class="btn-clear"
                            onclick="return confirm('Deseja limpar todo o carrinho?')">
                            üóëÔ∏è Limpar Carrinho
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== MODAL ADICIONAR ENDERE√áO ==================== -->
    <div class="modal-overlay" id="modalEndereco">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üìç Novo Endere√ßo de Entrega</h2>
                <button type="button" class="modal-close" onclick="fecharModalEndereco()">√ó</button>
            </div>

            <form class="modal-form" id="formNovoEndereco" onsubmit="salvarNovoEndereco(event)">
                <!-- CEP -->
                <div class="form-group">
                    <label class="form-label required" for="cep">CEP</label>
                    <div class="cep-group">
                        <input type="text" class="form-input" id="cep" name="cep" 
                               placeholder="00000-000" maxlength="9" required
                               oninput="formatarCEP(this)" onblur="buscarCEPModal()">
                        <button type="button" class="btn-buscar-cep" onclick="buscarCEPModal()">
                            üîç Buscar
                        </button>
                    </div>
                    <span class="form-error" id="cep-error">CEP inv√°lido</span>
                </div>

                <!-- Logradouro e N√∫mero -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label required" for="logradouro">Logradouro</label>
                        <input type="text" class="form-input" id="logradouro" name="logradouro" 
                               placeholder="Rua, Avenida..." required>
                        <span class="form-error" id="logradouro-error">Campo obrigat√≥rio</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label required" for="numero">N√∫mero</label>
                        <input type="text" class="form-input" id="numero" name="numero" 
                               placeholder="123" required>
                        <span class="form-error" id="numero-error">Campo obrigat√≥rio</span>
                    </div>
                </div>

                <!-- Complemento -->
                <div class="form-group">
                    <label class="form-label" for="complemento">Complemento</label>
                    <input type="text" class="form-input" id="complemento" name="complemento" 
                           placeholder="Apto, Bloco, Casa... (opcional)">
                </div>

                <!-- Bairro -->
                <div class="form-group">
                    <label class="form-label required" for="bairro">Bairro</label>
                    <input type="text" class="form-input" id="bairro" name="bairro" 
                           placeholder="Centro" required>
                    <span class="form-error" id="bairro-error">Campo obrigat√≥rio</span>
                </div>

                <!-- Cidade e Estado -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label required" for="cidade">Cidade</label>
                        <input type="text" class="form-input" id="cidade" name="cidade" 
                               placeholder="S√£o Paulo" required>
                        <span class="form-error" id="cidade-error">Campo obrigat√≥rio</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label required" for="estado">Estado</label>
                        <select class="form-input" id="estado" name="estado" required>
                            <option value="">Selecione...</option>
                            <option value="AC">Acre</option>
                            <option value="AL">Alagoas</option>
                            <option value="AP">Amap√°</option>
                            <option value="AM">Amazonas</option>
                            <option value="BA">Bahia</option>
                            <option value="CE">Cear√°</option>
                            <option value="DF">Distrito Federal</option>
                            <option value="ES">Esp√≠rito Santo</option>
                            <option value="GO">Goi√°s</option>
                            <option value="MA">Maranh√£o</option>
                            <option value="MT">Mato Grosso</option>
                            <option value="MS">Mato Grosso do Sul</option>
                            <option value="MG">Minas Gerais</option>
                            <option value="PA">Par√°</option>
                            <option value="PB">Para√≠ba</option>
                            <option value="PR">Paran√°</option>
                            <option value="PE">Pernambuco</option>
                            <option value="PI">Piau√≠</option>
                            <option value="RJ">Rio de Janeiro</option>
                            <option value="RN">Rio Grande do Norte</option>
                            <option value="RS">Rio Grande do Sul</option>
                            <option value="RO">Rond√¥nia</option>
                            <option value="RR">Roraima</option>
                            <option value="SC">Santa Catarina</option>
                            <option value="SP">S√£o Paulo</option>
                            <option value="SE">Sergipe</option>
                            <option value="TO">Tocantins</option>
                        </select>
                        <span class="form-error" id="estado-error">Selecione um estado</span>
                    </div>
                </div>

                <!-- Apelido -->
                <div class="form-group">
                    <label class="form-label required" for="apelido">Apelido do Endere√ßo</label>
                    <input type="text" class="form-input" id="apelido" name="apelido" 
                           placeholder="Ex: Casa, Trabalho, Casa da M√£e..." required>
                    <span class="form-error" id="apelido-error">Campo obrigat√≥rio</span>
                </div>

                <!-- Bot√µes -->
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="fecharModalEndereco()">
                        Cancelar
                    </button>
                    <button type="submit" class="btn-submit" id="btnSalvarEndereco">
                        üíæ Salvar Endere√ßo
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ==================== MODAL DE PAGAMENTO ==================== -->
    <div class="modal-overlay" id="modalPagamento">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üí≥ Forma de Pagamento</h2>
                <button type="button" class="modal-close" onclick="fecharModalPagamento()">√ó</button>
            </div>

            <!-- Op√ß√µes de Pagamento -->
            <div id="opcoesPagamento" class="payment-options">
                <div class="payment-option" onclick="selecionarFormaPagamento('cartao')">
                    <div class="payment-icon">üí≥</div>
                    <div class="payment-info">
                        <div class="payment-name">Cart√£o de Cr√©dito</div>
                        <div class="payment-desc">Parcelamento em at√© 12x</div>
                    </div>
                    <div class="payment-arrow">‚Üí</div>
                </div>
                
                <div class="payment-option" onclick="selecionarFormaPagamento('boleto')">
                    <div class="payment-icon">üìÑ</div>
                    <div class="payment-info">
                        <div class="payment-name">Boleto Banc√°rio</div>
                        <div class="payment-desc">√Ä vista com desconto</div>
                    </div>
                    <div class="payment-arrow">‚Üí</div>
                </div>
            </div>

            <!-- Formul√°rio Cart√£o -->
            <form id="formCartao" style="display: none;" onsubmit="processarPagamentoCartao(event)">
                <div class="modal-form" id="formularioCartao">
                    <div class="form-group">
                        <label class="form-label required" for="numeroCartao">N√∫mero do Cart√£o</label>
                        <input type="text" class="form-input payment-input" id="numeroCartao" 
                               placeholder="0000 0000 0000 0000" maxlength="19"
                               oninput="formatarNumeroCartao(this)" required>
                        <span class="form-error payment-error" id="numeroCartao-error"></span>
                    </div>

                    <div class="form-group">
                        <label class="form-label required" for="nomeCartao">Nome no Cart√£o</label>
                        <input type="text" class="form-input payment-input" id="nomeCartao" 
                               placeholder="Como est√° no cart√£o" required>
                        <span class="form-error payment-error" id="nomeCartao-error"></span>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required" for="validadeCartao">Validade</label>
                            <input type="text" class="form-input payment-input" id="validadeCartao" 
                                   placeholder="MM/AA" maxlength="5"
                                   oninput="formatarValidade(this)" required>
                            <span class="form-error payment-error" id="validadeCartao-error"></span>
                        </div>

                        <div class="form-group">
                            <label class="form-label required" for="cvvCartao">CVV</label>
                            <input type="text" class="form-input payment-input" id="cvvCartao" 
                                   placeholder="000" maxlength="3"
                                   oninput="formatarCVV(this)" required>
                            <span class="form-error payment-error" id="cvvCartao-error"></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required" for="parcelasCartao">Parcelas</label>
                        <select class="form-input payment-input" id="parcelasCartao" required>
                            <option value="">Selecione...</option>
                            <option value="1">1x de R$ <span id="valorParcela1"></span> (√† vista)</option>
                            <option value="2">2x de R$ <span id="valorParcela2"></span></option>
                            <option value="3">3x de R$ <span id="valorParcela3"></span></option>
                            <option value="4">4x de R$ <span id="valorParcela4"></span></option>
                            <option value="5">5x de R$ <span id="valorParcela5"></span></option>
                            <option value="6">6x de R$ <span id="valorParcela6"></span></option>
                        </select>
                        <span class="form-error payment-error" id="parcelasCartao-error"></span>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-cancel" onclick="voltarOpcoesPagamento()">
                            ‚Üê Voltar
                        </button>
                        <button type="submit" class="btn-submit">
                            ‚úÖ Continuar
                        </button>
                    </div>
                </div>
            </form>

            <!-- Formul√°rio Boleto -->
            <div id="formBoleto" style="display: none;">
                <div class="boleto-info">
                    <div class="boleto-icon">üìÑ</div>
                    <div class="boleto-text">
                        <h3>Boleto Banc√°rio</h3>
                        <p>Pagamento √† vista com vencimento em 3 dias √∫teis</p>
                        <p><strong>Desconto de 5%:</strong> R$ <span id="descontoBoleto"></span></p>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="voltarOpcoesPagamento()">
                        ‚Üê Voltar
                    </button>
                    <button type="button" class="btn-submit" onclick="processarPagamentoBoleto()">
                        ‚úÖ Gerar Boleto
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== MODAL DE RESUMO ==================== -->
    <div class="modal-overlay" id="modalResumo">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üìã Resumo do Pedido</h2>
                <button type="button" class="modal-close" onclick="fecharModalResumo()">√ó</button>
            </div>

            <div class="resumo-content">
                <div class="resumo-section">
                    <h3>üìç Endere√ßo de Entrega</h3>
                    <div id="resumoEndereco" class="resumo-info"></div>
                </div>

                <div class="resumo-section">
                    <h3>üöö Frete</h3>
                    <div id="resumoFrete" class="resumo-info"></div>
                </div>

                <div class="resumo-section">
                    <h3>üí≥ Pagamento</h3>
                    <div id="resumoPagamento" class="resumo-info"></div>
                </div>

                <div class="resumo-section">
                    <h3>üí∞ Valores</h3>
                    <div class="resumo-valores">
                        <div class="resumo-row">
                            <span>Subtotal:</span>
                            <span id="resumoSubtotal"></span>
                        </div>
                        <div class="resumo-row">
                            <span>Frete:</span>
                            <span id="resumoFrete2"></span>
                        </div>
                        <div class="resumo-row total">
                            <span>Total:</span>
                            <span id="resumoTotal"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn-cancel" onclick="voltarParaPagamento()">
                    ‚Üê Alterar Pagamento
                </button>
                <button type="button" class="btn-submit" id="btnConcluirCompra" onclick="concluirCompra()">
                    ‚úÖ Confirmar Pedido
                </button>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        // ===== VARI√ÅVEIS GLOBAIS =====
        /*<![CDATA[*/
        const clienteLogado = /*[[${session.clienteLogado != null}]]*/ false;
        const subtotalOriginal = /*[[${cartTotal}]]*/ 0;
        /*]]>*/

        let enderecoSelecionadoId = null;
        let freteSelecionado = null;
        let opcoesFreteGlobal = [];
        let cepAtual = null;
        let formaPagamentoSelecionada = null;
        let dadosPagamento = null;

        // ===== INICIALIZA√á√ÉO =====
        document.addEventListener('DOMContentLoaded', function () {
            console.log('=== INICIALIZANDO CARRINHO ===');
            console.log('Cliente logado:', clienteLogado);

            // Se h√° endere√ßo padr√£o selecionado, calcula o frete automaticamente
            const enderecoSelecionado = document.querySelector('.address-item.selected');
            if (enderecoSelecionado) {
                const enderecoId = enderecoSelecionado.dataset.enderecoId;
                console.log('Endere√ßo padr√£o encontrado:', enderecoId);
                enderecoSelecionadoId = enderecoId;

                // Aguarda um pouco e calcula o frete
                setTimeout(function () {
                    calcularFreteParaEndereco(enderecoId);
                }, 500);
            }

            // Adiciona event listeners para valida√ß√£o em tempo real
            const numeroCartaoInput = document.getElementById('numeroCartao');
            const nomeCartaoInput = document.getElementById('nomeCartao');
            const validadeInput = document.getElementById('validadeCartao');
            const cvvInput = document.getElementById('cvvCartao');
            
            if (numeroCartaoInput) {
                numeroCartaoInput.addEventListener('blur', function() {
                    if (this.value && !validarNumeroCartao(this.value)) {
                        mostrarErroPagamento('numeroCartao', 'N√∫mero de cart√£o inv√°lido');
                    }
                });
            }
            
            if (validadeInput) {
                validadeInput.addEventListener('blur', function() {
                    if (this.value && !validarValidade(this.value)) {
                        mostrarErroPagamento('validadeCartao', 'Data de validade inv√°lida ou expirada');
                    }
                });
            }
            
            if (cvvInput) {
                cvvInput.addEventListener('blur', function() {
                    if (this.value && this.value.length !== 3) {
                        mostrarErroPagamento('cvvCartao', 'CVV deve ter 3 d√≠gitos');
                    }
                });
            }
        });

        // ===== SELE√á√ÉO DE ENDERE√áO =====
        function selecionarEndereco(element) {
            console.log('=== SELECIONANDO ENDERE√áO ===');

            // Remove sele√ß√£o anterior
            document.querySelectorAll('.address-item').forEach(item => {
                item.classList.remove('selected');
            });

            // Adiciona sele√ß√£o ao novo
            element.classList.add('selected');

            // Marca o radio button
            const radio = element.querySelector('input[type="radio"]');
            radio.checked = true;

            // Obt√©m ID do endere√ßo
            const enderecoId = element.dataset.enderecoId;
            enderecoSelecionadoId = enderecoId;

            console.log('Endere√ßo selecionado:', enderecoId);

            // Calcula frete para o novo endere√ßo
            calcularFreteParaEndereco(enderecoId);
        }

        // ===== CALCULAR FRETE PARA ENDERE√áO =====
        function calcularFreteParaEndereco(enderecoId) {
            console.log('=== CALCULANDO FRETE PARA ENDERE√áO ===');
            console.log('Endere√ßo ID:', enderecoId);

            // Obt√©m o CEP do endere√ßo selecionado
            const enderecoElement = document.querySelector(`[data-endereco-id="${enderecoId}"]`);
            if (!enderecoElement) {
                console.error('Elemento de endere√ßo n√£o encontrado');
                return;
            }

            // Extrai CEP do texto
            const addressText = enderecoElement.querySelector('.address-details').textContent;
            const cepMatch = addressText.match(/CEP:\s*(\d{5}-\d{3})/);

            if (!cepMatch) {
                console.error('CEP n√£o encontrado no endere√ßo');
                mostrarNotificacao('Erro ao obter CEP do endere√ßo', 'error');
                return;
            }

            const cep = cepMatch[1].replace('-', '');
            cepAtual = cep;
            console.log('CEP extra√≠do:', cep);

            // Mostra loading
            const shippingSection = document.getElementById('shippingSection');
            shippingSection.style.display = 'block';
            document.getElementById('shippingOptions').innerHTML = '<p style="text-align: center; color: #6b7280;">‚è≥ Calculando frete...</p>';

            // Faz requisi√ß√£o
            fetch('/frete/calcular', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'cep=' + cep
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Resposta do servidor:', data);

                    if (data.success) {
                        exibirOpcoesFlrete(data.opcoes, data.cepInfo);
                    } else {
                        console.error('Erro:', data.message);
                        document.getElementById('shippingOptions').innerHTML =
                            '<p style="text-align: center; color: #ef4444;">‚ùå ' + data.message + '</p>';
                    }
                })
                .catch(error => {
                    console.error('Erro na requisi√ß√£o:', error);
                    document.getElementById('shippingOptions').innerHTML =
                        '<p style="text-align: center; color: #ef4444;">‚ùå Erro ao calcular frete</p>';
                });
        }

        // ===== EXIBIR OP√á√ïES DE FRETE =====
        function exibirOpcoesFlrete(opcoes, cepInfo) {
            console.log('=== EXIBINDO OP√á√ïES DE FRETE ===');
            console.log('Op√ß√µes:', opcoes);

            // Armazena op√ß√µes globalmente
            opcoesFreteGlobal = opcoes;

            // Exibe informa√ß√µes do CEP
            const shippingInfo = document.getElementById('shippingInfo');
            shippingInfo.innerHTML = `
                <strong>üìç Entrega para:</strong><br>
                ${cepInfo.localidade} - ${cepInfo.uf}
            `;
            shippingInfo.style.display = 'block';

            // Exibe op√ß√µes
            const container = document.getElementById('shippingOptions');
            let html = '';

            opcoes.forEach((opcao, index) => {
                const valorFormatado = opcao.freteGratis ? 'GR√ÅTIS' :
                    'R$ ' + parseFloat(opcao.valor).toFixed(2).replace('.', ',');

                html += `
                    <div class="shipping-option" data-index="${index}" onclick="selecionarFreteByIndex(${index})">
                        <div class="shipping-option-header">
                            <span class="shipping-name">${opcao.nome}</span>
                            <span class="shipping-price ${opcao.freteGratis ? 'free' : ''}">
                                ${valorFormatado}
                                ${opcao.freteGratis ? '<span class="free-badge">üéâ GR√ÅTIS</span>' : ''}
                            </span>
                        </div>
                        <div class="shipping-details">
                            <span>${opcao.descricao}</span>
                            <span>‚è±Ô∏è ${opcao.prazoFormatado}</span>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;

            // Seleciona automaticamente a primeira op√ß√£o
            if (opcoes.length > 0) {
                setTimeout(() => {
                    selecionarFreteByIndex(0);
                }, 100);
            }
        }

        // ===== SELECIONAR FRETE POR √çNDICE =====
        function selecionarFreteByIndex(index) {
            const opcao = opcoesFreteGlobal[index];
            if (!opcao) {
                console.error('Op√ß√£o de frete n√£o encontrada:', index);
                return;
            }
            selecionarFrete(opcao);
        }

        // ===== SELECIONAR FRETE =====
        function selecionarFrete(opcao) {
            console.log('=== SELECIONANDO FRETE ===');
            console.log('Op√ß√£o:', opcao);

            fetch('/frete/selecionar', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'tipoFrete=' + opcao.tipo
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Resposta do servidor:', data);

                    if (data.success) {
                        freteSelecionado = opcao;

                        // Atualiza visual das op√ß√µes
                        document.querySelectorAll('.shipping-option').forEach(el => {
                            el.classList.remove('selected');
                        });

                        const opcaoElement = document.querySelector(`.shipping-option[data-index="${opcoesFreteGlobal.indexOf(opcao)}"]`);
                        if (opcaoElement) {
                            opcaoElement.classList.add('selected');
                        }

                        // Atualiza resumo
                        atualizarResumo(data.valorFrete, data.valorTotal);

                        // Mostra notifica√ß√£o
                        mostrarNotificacao('Frete selecionado: ' + opcao.nome, 'success');
                    } else {
                        mostrarNotificacao(data.message, 'error');
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    mostrarNotificacao('Erro ao selecionar frete', 'error');
                });
        }

        // ===== ATUALIZAR RESUMO =====
        function atualizarResumo(valorFrete, valorTotal) {
            console.log('=== ATUALIZANDO RESUMO ===');
            console.log('Frete:', valorFrete, 'Total:', valorTotal);

            const freteRow = document.getElementById('freteRow');
            const freteValue = document.getElementById('freteValue');
            const totalValue = document.getElementById('totalValue');

            freteRow.style.display = 'flex';

            if (valorFrete === 0 || valorFrete === '0.00') {
                freteValue.innerHTML = '<span style="color: #10b981; font-weight: 700;">GR√ÅTIS üéâ</span>';
            } else {
                freteValue.textContent = 'R$ ' + parseFloat(valorFrete).toFixed(2).replace('.', ',');
            }

            totalValue.textContent = 'R$ ' + parseFloat(valorTotal).toFixed(2).replace('.', ',');
        }

        // ===== FINALIZAR COMPRA =====
        function finalizarCompra() {
            console.log('=== FINALIZANDO COMPRA ===');

            // Verifica se cliente est√° logado
            if (!clienteLogado) {
                if (confirm('Voc√™ precisa fazer login para finalizar a compra.\n\nDeseja fazer login agora?')) {
                    window.location.href = '/cliente/login';
                }
                return;
            }

            // Verifica se endere√ßo foi selecionado
            if (!enderecoSelecionadoId) {
                mostrarNotificacao('Por favor, selecione um endere√ßo de entrega', 'error');
                return;
            }

            // Verifica se frete foi selecionado
            if (!freteSelecionado) {
                mostrarNotificacao('Por favor, aguarde o c√°lculo do frete', 'error');
                return;
            }

            // Abre modal de pagamento
            abrirModalPagamento();
        }

        // ===== MODAL DE PAGAMENTO =====
        function abrirModalPagamento() {
            const modal = document.getElementById('modalPagamento');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Reseta o formul√°rio
            formaPagamentoSelecionada = null;
            dadosPagamento = null;
            mostrarOpcoesPagamento();
            
            // Prepara valores das parcelas
            prepararParcelas();
        }

        function fecharModalPagamento() {
            const modal = document.getElementById('modalPagamento');
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        function mostrarOpcoesPagamento() {
            document.getElementById('opcoesPagamento').style.display = 'block';
            document.getElementById('formCartao').style.display = 'none';
            document.getElementById('formBoleto').style.display = 'none';
        }

        function selecionarFormaPagamento(tipo) {
            formaPagamentoSelecionada = tipo;
            
            document.getElementById('opcoesPagamento').style.display = 'none';
            
            if (tipo === 'cartao') {
                document.getElementById('formCartao').style.display = 'block';
            } else {
                document.getElementById('formBoleto').style.display = 'block';
                // Calcula desconto do boleto
                const total = parseFloat(document.getElementById('totalValue').textContent.replace('R$ ', '').replace(',', '.'));
                const desconto = total * 0.05;
                document.getElementById('descontoBoleto').textContent = desconto.toFixed(2).replace('.', ',');
            }
        }

        function voltarOpcoesPagamento() {
            mostrarOpcoesPagamento();
            formaPagamentoSelecionada = null;
            
            // Limpa os formul√°rios
            document.getElementById('formularioCartao').reset();
            limparErrosPagamento();
        }

        function limparErrosPagamento() {
            document.querySelectorAll('.payment-error').forEach(error => {
                error.classList.remove('active');
            });
            document.querySelectorAll('.payment-input').forEach(input => {
                input.classList.remove('error');
            });
        }

        function mostrarErroPagamento(campo, mensagem) {
            const input = document.getElementById(campo);
            const error = document.getElementById(campo + '-error');
            
            input.classList.add('error');
            error.textContent = mensagem;
            error.classList.add('active');
        }

        function limparErroPagamento(campo) {
            const input = document.getElementById(campo);
            const error = document.getElementById(campo + '-error');
            
            input.classList.remove('error');
            error.classList.remove('active');
        }

        function prepararParcelas() {
            const total = parseFloat(document.getElementById('totalValue').textContent.replace('R$ ', '').replace(',', '.'));
            
            for (let i = 1; i <= 6; i++) {
                const valorParcela = total / i;
                document.getElementById('valorParcela' + i).textContent = valorParcela.toFixed(2).replace('.', ',');
            }
        }

        // Formata√ß√£o de cart√£o
        function formatarNumeroCartao(input) {
            let valor = input.value.replace(/\D/g, '');
            valor = valor.substring(0, 16);
            valor = valor.replace(/(\d{4})/g, '$1 ').trim();
            input.value = valor;
            limparErroPagamento('numeroCartao');
        }

        function formatarCVV(input) {
            let valor = input.value.replace(/\D/g, '');
            input.value = valor.substring(0, 3);
            limparErroPagamento('cvvCartao');
        }

        function formatarValidade(input) {
            let valor = input.value.replace(/\D/g, '');
            if (valor.length >= 2) {
                valor = valor.substring(0, 2) + '/' + valor.substring(2, 4);
            }
            input.value = valor;
            limparErroPagamento('validadeCartao');
        }

        function validarNumeroCartao(numero) {
            numero = numero.replace(/\s/g, '');
            if (numero.length !== 16) return false;
            
            // Algoritmo de Luhn
            let soma = 0;
            let ehPar = false;
            
            for (let i = numero.length - 1; i >= 0; i--) {
                let digito = parseInt(numero.charAt(i));
                
                if (ehPar) {
                    digito *= 2;
                    if (digito > 9) digito -= 9;
                }
                
                soma += digito;
                ehPar = !ehPar;
            }
            
            return (soma % 10) === 0;
        }

        function validarValidade(validade) {
            const [mes, ano] = validade.split('/');
            if (!mes || !ano) return false;
            
            const mesNum = parseInt(mes);
            const anoNum = parseInt('20' + ano);
            
            if (mesNum < 1 || mesNum > 12) return false;
            
            const hoje = new Date();
            const dataValidade = new Date(anoNum, mesNum - 1);
            
            return dataValidade >= hoje;
        }

        function processarPagamentoCartao(event) {
            event.preventDefault();
            
            limparErrosPagamento();
            
            const numeroCartao = document.getElementById('numeroCartao').value;
            const nomeCartao = document.getElementById('nomeCartao').value;
            const validadeCartao = document.getElementById('validadeCartao').value;
            const cvvCartao = document.getElementById('cvvCartao').value;
            const parcelasCartao = document.getElementById('parcelasCartao').value;
            
            let temErro = false;
            
            // Valida n√∫mero do cart√£o
            if (!validarNumeroCartao(numeroCartao)) {
                mostrarErroPagamento('numeroCartao', 'N√∫mero de cart√£o inv√°lido');
                temErro = true;
            }
            
            // Valida nome
            if (nomeCartao.trim().split(' ').length < 2) {
                mostrarErroPagamento('nomeCartao', 'Digite o nome completo como est√° no cart√£o');
                temErro = true;
            }
            
            // Valida validade
            if (!validarValidade(validadeCartao)) {
                mostrarErroPagamento('validadeCartao', 'Data de validade inv√°lida ou expirada');
                temErro = true;
            }
            
            // Valida CVV
            if (cvvCartao.length !== 3) {
                mostrarErroPagamento('cvvCartao', 'CVV deve ter 3 d√≠gitos');
                temErro = true;
            }
            
            // Valida parcelas
            if (!parcelasCartao) {
                mostrarErroPagamento('parcelasCartao', 'Selecione o n√∫mero de parcelas');
                temErro = true;
            }
            
            if (temErro) return;
            
            // Salva dados do pagamento
            dadosPagamento = {
                tipo: 'cartao',
                nome: 'Cart√£o de Cr√©dito',
                numeroCartao: numeroCartao.replace(/\s/g, '').replace(/(\d{4})(\d{4})(\d{4})(\d{4})/, '**** **** **** $4'),
                nomeCartao: nomeCartao,
                parcelas: parseInt(parcelasCartao)
            };
            
            fecharModalPagamento();
            abrirModalResumo();
        }

        function processarPagamentoBoleto() {
            dadosPagamento = {
                tipo: 'boleto',
                nome: 'Boleto Banc√°rio'
            };
            
            fecharModalPagamento();
            abrirModalResumo();
        }

        // ===== MODAL DE RESUMO =====
        function abrirModalResumo() {
            const modal = document.getElementById('modalResumo');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            preencherResumo();
        }

        function fecharModalResumo() {
            const modal = document.getElementById('modalResumo');
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        function voltarParaPagamento() {
            fecharModalResumo();
            abrirModalPagamento();
        }

        function preencherResumo() {
            const enderecoElement = document.querySelector(`[data-endereco-id="${enderecoSelecionadoId}"]`);
            const enderecoApelido = enderecoElement.querySelector('.address-apelido').textContent;
            const enderecoDetalhes = enderecoElement.querySelector('.address-details').textContent.trim();
            
            document.getElementById('resumoEndereco').innerHTML = `
                <strong>${enderecoApelido}</strong><br>
                ${enderecoDetalhes.replace(/\n/g, '<br>')}
            `;
            
            document.getElementById('resumoFrete').innerHTML = `
                <strong>${freteSelecionado.nome}</strong><br>
                ${freteSelecionado.descricao} - ${freteSelecionado.prazoFormatado}
            `;
            
            let pagamentoHTML = `<strong>${dadosPagamento.nome}</strong><br>`;
            if (dadosPagamento.tipo === 'cartao') {
                pagamentoHTML += `${dadosPagamento.numeroCartao}<br>`;
                const total = parseFloat(document.getElementById('totalValue').textContent.replace('R$ ', '').replace(',', '.'));
                const valorParcela = (total / dadosPagamento.parcelas).toFixed(2).replace('.', ',');
                pagamentoHTML += `${dadosPagamento.parcelas}x de R$ ${valorParcela}`;
            } else {
                pagamentoHTML += `√Ä vista - Vencimento em 3 dias √∫teis`;
            }
            document.getElementById('resumoPagamento').innerHTML = pagamentoHTML;
            
            document.getElementById('resumoSubtotal').textContent = document.getElementById('subtotalValue').textContent;
            document.getElementById('resumoFrete2').textContent = document.getElementById('freteValue').textContent;
            document.getElementById('resumoTotal').textContent = document.getElementById('totalValue').textContent;
        }

        function concluirCompra() {
            const btnConcluir = document.getElementById('btnConcluirCompra');
            btnConcluir.disabled = true;
            btnConcluir.innerHTML = '‚è≥ Processando...';
            
            // Simula processamento
            setTimeout(() => {
                fecharModalResumo();
                
                // Limpa o carrinho
                fetch('/carrinho/limpar', {
                    method: 'POST'
                }).then(() => {
                    mostrarNotificacao('üéâ Pedido realizado com sucesso! Em breve voc√™ receber√° um e-mail com os detalhes.', 'success');
                    
                    setTimeout(() => {
                        window.location.href = '/home';
                    }, 3000);
                });
            }, 2000);
        }

        // ===== CONTROLES DE QUANTIDADE =====
        function incrementQty(produtoId) {
            const input = document.getElementById('qty-' + produtoId);
            input.value = parseInt(input.value) + 1;
            document.getElementById('btnUpdate-' + produtoId).click();
        }

        function decrementQty(produtoId) {
            const input = document.getElementById('qty-' + produtoId);
            const currentValue = parseInt(input.value);
            if (currentValue > 1) {
                input.value = currentValue - 1;
                document.getElementById('btnUpdate-' + produtoId).click();
            }
        }

        // ===== NOTIFICA√á√ïES =====
        function mostrarNotificacao(mensagem, tipo) {
            const notificacao = document.createElement('div');
            notificacao.className = 'alert alert-' + tipo;
            notificacao.textContent = mensagem;
            notificacao.style.position = 'fixed';
            notificacao.style.top = '100px';
            notificacao.style.left = '50%';
            notificacao.style.transform = 'translateX(-50%)';
            notificacao.style.zIndex = '9999';
            notificacao.style.minWidth = '300px';

            document.body.appendChild(notificacao);

            setTimeout(() => {
                notificacao.style.animation = 'fadeOut 0.5s ease-out';
                setTimeout(() => {
                    if (document.body.contains(notificacao)) {
                        document.body.removeChild(notificacao);
                    }
                }, 500);
            }, 3000);
        }

        // ===== MODAL DE ENDERE√áO =====
        function abrirModalEndereco() {
            if (!clienteLogado) {
                if (confirm('Voc√™ precisa fazer login para adicionar um endere√ßo.\n\nDeseja fazer login agora?')) {
                    window.location.href = '/cliente/login';
                }
                return;
            }

            const modal = document.getElementById('modalEndereco');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function fecharModalEndereco() {
            const modal = document.getElementById('modalEndereco');
            modal.classList.remove('active');
            document.body.style.overflow = '';
            
            // Limpa o formul√°rio
            document.getElementById('formNovoEndereco').reset();
            
            // Remove erros
            document.querySelectorAll('.form-error').forEach(error => {
                error.classList.remove('active');
            });
            document.querySelectorAll('.form-input').forEach(input => {
                input.classList.remove('error');
            });
        }

        // Fecha modal ao clicar fora
        document.getElementById('modalEndereco').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharModalEndereco();
            }
        });

        // Fecha modais de pagamento ao clicar fora
        document.getElementById('modalPagamento')?.addEventListener('click', function(e) {
            if (e.target === this) {
                fecharModalPagamento();
            }
        });

        document.getElementById('modalResumo')?.addEventListener('click', function(e) {
            if (e.target === this) {
                fecharModalResumo();
            }
        });

        // ===== FORMATA√á√ÉO E VALIDA√á√ÉO =====
        function formatarCEP(input) {
            let valor = input.value.replace(/\D/g, '');
            if (valor.length > 5) {
                valor = valor.substring(0, 5) + '-' + valor.substring(5, 8);
            }
            input.value = valor;
        }

        function buscarCEPModal() {
            const cepInput = document.getElementById('cep');
            const cep = cepInput.value.replace(/\D/g, '');
            
            if (cep.length !== 8) {
                mostrarErro('cep', 'CEP deve ter 8 d√≠gitos');
                return;
            }

            // Desabilita o bot√£o e mostra loading
            const btnBuscar = document.querySelector('.btn-buscar-cep');
            const textoOriginal = btnBuscar.innerHTML;
            btnBuscar.disabled = true;
            btnBuscar.innerHTML = '<span class="loading"></span>';

            fetch('/cliente/buscar-cep?cep=' + cep)
                .then(response => response.json())
                .then(data => {
                    if (data.erro) {
                        mostrarErro('cep', 'CEP n√£o encontrado');
                    } else {
                        // Preenche os campos
                        document.getElementById('logradouro').value = data.logradouro || '';
                        document.getElementById('bairro').value = data.bairro || '';
                        document.getElementById('cidade').value = data.localidade || '';
                        document.getElementById('estado').value = data.uf || '';
                        
                        // Remove erros
                        limparErro('cep');
                        
                        // Foca no campo n√∫mero
                        document.getElementById('numero').focus();
                        
                        mostrarNotificacao('CEP encontrado! ‚úì', 'success');
                    }
                })
                .catch(error => {
                    console.error('Erro ao buscar CEP:', error);
                    mostrarErro('cep', 'Erro ao buscar CEP');
                })
                .finally(() => {
                    btnBuscar.disabled = false;
                    btnBuscar.innerHTML = textoOriginal;
                });
        }

        function mostrarErro(campo, mensagem) {
            const input = document.getElementById(campo);
            const error = document.getElementById(campo + '-error');
            
            input.classList.add('error');
            error.textContent = mensagem;
            error.classList.add('active');
        }

        function limparErro(campo) {
            const input = document.getElementById(campo);
            const error = document.getElementById(campo + '-error');
            
            input.classList.remove('error');
            error.classList.remove('active');
        }

        // ===== SALVAR NOVO ENDERE√áO =====
        function salvarNovoEndereco(event) {
            event.preventDefault();
            
            console.log('=== SALVANDO NOVO ENDERE√áO ===');
            
            // Valida√ß√£o b√°sica
            const form = document.getElementById('formNovoEndereco');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            // Coleta dados
            const formData = new FormData(form);
            const dados = {};
            formData.forEach((value, key) => {
                dados[key] = value;
            });

            // Remove formata√ß√£o do CEP
            dados.cep = dados.cep.replace(/\D/g, '');

            console.log('Dados:', dados);

            // Desabilita bot√£o
            const btnSalvar = document.getElementById('btnSalvarEndereco');
            const textoOriginal = btnSalvar.innerHTML;
            btnSalvar.disabled = true;
            btnSalvar.innerHTML = '‚è≥ Salvando...';

            // Constr√≥i URL encoded
            const params = new URLSearchParams(dados).toString();

            // Envia requisi√ß√£o
            fetch('/cliente/perfil/adicionar-endereco', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: params
            })
            .then(response => {
                if (response.ok) {
                    return response.text();
                }
                throw new Error('Erro ao salvar endere√ßo');
            })
            .then(() => {
                console.log('Endere√ßo salvo com sucesso!');
                mostrarNotificacao('Endere√ßo adicionado com sucesso! üéâ', 'success');
                
                // Fecha modal
                fecharModalEndereco();
                
                // Recarrega a p√°gina para mostrar o novo endere√ßo
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            })
            .catch(error => {
                console.error('Erro:', error);
                mostrarNotificacao('Erro ao adicionar endere√ßo. Tente novamente.', 'error');
            })
            .finally(() => {
                btnSalvar.disabled = false;
                btnSalvar.innerHTML = textoOriginal;
            });
        }
    </script>
</body>

</html>