<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Cadastro de Cliente - WebStyle</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .cadastro-container {
            max-width: 800px;
            margin: 20px auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-icon {
            font-size: 50px;
            margin-bottom: 10px;
        }

        .logo-name {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h2 {
            color: #1f2937;
            font-size: 26px;
            text-align: center;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #6b7280;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .alert {
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .section-title {
            color: #667eea;
            font-size: 18px;
            font-weight: 700;
            margin: 30px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title:first-of-type {
            margin-top: 0;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            color: #374151;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .required::after {
            content: " *";
            color: #ef4444;
            font-weight: bold;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="date"],
        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        input.valid {
            border-color: #10b981;
        }

        input.invalid {
            border-color: #ef4444;
        }

        .validation-message {
            font-size: 12px;
            margin-top: 5px;
            display: block;
        }

        .validation-message.success {
            color: #10b981;
        }

        .validation-message.error {
            color: #ef4444;
        }

        .info-box {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #1e40af;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checkbox-group:hover {
            background: #f3f4f6;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            flex: 1;
        }

        .endereco-entrega-fields {
            display: none;
            animation: slideDown 0.3s ease-out;
        }

        .endereco-entrega-fields.show {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 1000px;
            }
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
        }

        .btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 2px solid #d1d5db;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .btn-buscar-cep {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            margin-top: 5px;
        }

        .btn-buscar-cep:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .btn-buscar-cep:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .back-login {
            text-align: center;
            margin-top: 20px;
        }

        .back-login a {
            color: #667eea;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .back-login a:hover {
            text-decoration: underline;
        }

        small {
            display: block;
            color: #6b7280;
            font-size: 12px;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .cadastro-container {
                padding: 30px 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 0;
            }

            h2 {
                font-size: 22px;
            }

            .section-title {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="cadastro-container">
        <!-- Logo -->
        <div class="logo-section">
            <div class="logo-icon">üëî</div>
            <div class="logo-name">WebStyle</div>
        </div>

        <h2>Criar Conta</h2>
        <p class="subtitle">Preencha os dados abaixo para criar sua conta</p>

        <!-- Mensagem de erro -->
        <div th:if="${erro}" class="alert alert-error" th:text="${erro}"></div>

        <!-- Formul√°rio de Cadastro -->
        <form th:action="@{/cliente/cadastro}" method="post" id="formCadastro" onsubmit="return validarFormulario()">
            
            <!-- SE√á√ÉO 1: DADOS PESSOAIS -->
            <div class="section-title">
                üë§ Dados Pessoais
            </div>

            <div class="form-group">
                <label for="nomeCompleto" class="required">Nome Completo</label>
                <input type="text" 
                       id="nomeCompleto" 
                       name="nomeCompleto" 
                       th:value="${cliente?.nomeCompleto}"
                       required 
                       placeholder="Digite seu nome completo"
                       oninput="validarNome(this)">
                <small>M√≠nimo 2 palavras, cada uma com pelo menos 3 letras</small>
                <span id="nomeValidation" class="validation-message"></span>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="email" class="required">E-mail</label>
                    <input type="email" 
                           id="email" 
                           name="email" 
                           th:value="${cliente?.email}"
                           required 
                           placeholder="seu@email.com"
                           oninput="validarEmail(this)">
                    <span id="emailValidation" class="validation-message"></span>
                </div>

                <div class="form-group">
                    <label for="cpf" class="required">CPF</label>
                    <input type="text" 
                           id="cpf" 
                           name="cpf" 
                           th:value="${cliente?.cpf}"
                           required 
                           maxlength="14"
                           placeholder="000.000.000-00"
                           oninput="formatarValidarCPF(this)">
                    <span id="cpfValidation" class="validation-message"></span>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="dataNascimento" class="required">Data de Nascimento</label>
                    <input type="date" 
                           id="dataNascimento" 
                           name="dataNascimento" 
                           th:value="${cliente?.dataNascimento}"
                           required
                           onchange="validarIdade(this)">
                    <span id="idadeValidation" class="validation-message"></span>
                </div>

                <div class="form-group">
                    <label for="genero" class="required">G√™nero</label>
                    <select id="genero" name="genero" required>
                        <option value="">Selecione</option>
                        <option value="MASCULINO" th:selected="${cliente?.genero == 'MASCULINO'}">Masculino</option>
                        <option value="FEMININO" th:selected="${cliente?.genero == 'FEMININO'}">Feminino</option>
                        <option value="OUTRO" th:selected="${cliente?.genero == 'OUTRO'}">Outro</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="senha" class="required">Senha</label>
                    <input type="password" 
                           id="senha" 
                           name="senha" 
                           required 
                           minlength="6"
                           placeholder="M√≠nimo 6 caracteres"
                           oninput="validarSenhas()">
                    <small>M√≠nimo 6 caracteres</small>
                </div>

                <div class="form-group">
                    <label for="confirmarSenha" class="required">Confirmar Senha</label>
                    <input type="password" 
                           id="confirmarSenha" 
                           name="confirmarSenha" 
                           required 
                           minlength="6"
                           placeholder="Digite a senha novamente"
                           oninput="validarSenhas()">
                    <span id="senhaValidation" class="validation-message"></span>
                </div>
            </div>

            <!-- SE√á√ÉO 2: ENDERE√áO DE FATURAMENTO -->
            <div class="section-title">
                üè† Endere√ßo de Faturamento
            </div>

            <div class="info-box">
                ‚ÑπÔ∏è Este endere√ßo ser√° usado para emiss√£o de nota fiscal
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="cepFaturamento" class="required">CEP</label>
                    <input type="text" 
                           id="cepFaturamento" 
                           name="cepFaturamento" 
                           th:value="${cepFaturamento}"
                           required 
                           maxlength="9"
                           placeholder="00000-000"
                           oninput="formatarCep(this)">
                    <button type="button" 
                            class="btn-buscar-cep" 
                            onclick="buscarCep('Faturamento')"
                            id="btnBuscarCepFaturamento">
                        Buscar CEP
                    </button>
                    <span id="cepFaturamentoValidation" class="validation-message"></span>
                </div>

                <div class="form-group">
                    <label for="estadoFaturamento" class="required">Estado</label>
                    <select id="estadoFaturamento" name="estadoFaturamento" required>
                        <option value="">Selecione</option>
                        <option value="AC">Acre</option>
                        <option value="AL">Alagoas</option>
                        <option value="AP">Amap√°</option>
                        <option value="AM">Amazonas</option>
                        <option value="BA">Bahia</option>
                        <option value="CE">Cear√°</option>
                        <option value="DF">Distrito Federal</option>
                        <option value="ES">Esp√≠rito Santo</option>
                        <option value="GO">Goi√°s</option>
                        <option value="MA">Maranh√£o</option>
                        <option value="MT">Mato Grosso</option>
                        <option value="MS">Mato Grosso do Sul</option>
                        <option value="MG">Minas Gerais</option>
                        <option value="PA">Par√°</option>
                        <option value="PB">Para√≠ba</option>
                        <option value="PR">Paran√°</option>
                        <option value="PE">Pernambuco</option>
                        <option value="PI">Piau√≠</option>
                        <option value="RJ">Rio de Janeiro</option>
                        <option value="RN">Rio Grande do Norte</option>
                        <option value="RS">Rio Grande do Sul</option>
                        <option value="RO">Rond√¥nia</option>
                        <option value="RR">Roraima</option>
                        <option value="SC">Santa Catarina</option>
                        <option value="SP" selected>S√£o Paulo</option>
                        <option value="SE">Sergipe</option>
                        <option value="TO">Tocantins</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="cidadeFaturamento" class="required">Cidade</label>
                    <input type="text" 
                           id="cidadeFaturamento" 
                           name="cidadeFaturamento" 
                           th:value="${cidadeFaturamento}"
                           required 
                           placeholder="Nome da cidade">
                </div>

                <div class="form-group">
                    <label for="bairroFaturamento" class="required">Bairro</label>
                    <input type="text" 
                           id="bairroFaturamento" 
                           name="bairroFaturamento" 
                           th:value="${bairroFaturamento}"
                           required 
                           placeholder="Nome do bairro">
                </div>
            </div>

            <div class="form-group">
                <label for="logradouroFaturamento" class="required">Logradouro</label>
                <input type="text" 
                       id="logradouroFaturamento" 
                       name="logradouroFaturamento" 
                       th:value="${logradouroFaturamento}"
                       required 
                       placeholder="Rua, Avenida, etc.">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="numeroFaturamento" class="required">N√∫mero</label>
                    <input type="text" 
                           id="numeroFaturamento" 
                           name="numeroFaturamento" 
                           th:value="${numeroFaturamento}"
                           required 
                           placeholder="N¬∫">
                </div>

                <div class="form-group">
                    <label for="complementoFaturamento">Complemento</label>
                    <input type="text" 
                           id="complementoFaturamento" 
                           name="complementoFaturamento" 
                           th:value="${complementoFaturamento}"
                           placeholder="Apto, Bloco, etc. (opcional)">
                </div>
            </div>

            <!-- SE√á√ÉO 3: ENDERE√áO DE ENTREGA -->
            <div class="section-title">
                üì¶ Endere√ßo de Entrega
            </div>

            <div class="checkbox-group" onclick="toggleCopiarEndereco()">
                <input type="checkbox" 
                       id="copiarEndereco" 
                       name="copiarEndereco" 
                       value="true"
                       onchange="toggleEnderecoEntrega()">
                <label for="copiarEndereco">
                    Usar o mesmo endere√ßo de faturamento para entrega
                </label>
            </div>

            <div id="enderecoEntregaFields" class="endereco-entrega-fields">
                <div class="info-box">
                    ‚ÑπÔ∏è Este endere√ßo ser√° usado para entrega dos produtos
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="cepEntrega" class="required">CEP</label>
                        <input type="text" 
                               id="cepEntrega" 
                               name="cepEntrega" 
                               th:value="${cepEntrega}"
                               maxlength="9"
                               placeholder="00000-000"
                               oninput="formatarCep(this)">
                        <button type="button" 
                                class="btn-buscar-cep" 
                                onclick="buscarCep('Entrega')"
                                id="btnBuscarCepEntrega">
                            Buscar CEP
                        </button>
                        <span id="cepEntregaValidation" class="validation-message"></span>
                    </div>

                    <div class="form-group">
                        <label for="estadoEntrega" class="required">Estado</label>
                        <select id="estadoEntrega" name="estadoEntrega">
                            <option value="">Selecione</option>
                            <option value="AC">Acre</option>
                            <option value="AL">Alagoas</option>
                            <option value="AP">Amap√°</option>
                            <option value="AM">Amazonas</option>
                            <option value="BA">Bahia</option>
                            <option value="CE">Cear√°</option>
                            <option value="DF">Distrito Federal</option>
                            <option value="ES">Esp√≠rito Santo</option>
                            <option value="GO">Goi√°s</option>
                            <option value="MA">Maranh√£o</option>
                            <option value="MT">Mato Grosso</option>
                            <option value="MS">Mato Grosso do Sul</option>
                            <option value="MG">Minas Gerais</option>
                            <option value="PA">Par√°</option>
                            <option value="PB">Para√≠ba</option>
                            <option value="PR">Paran√°</option>
                            <option value="PE">Pernambuco</option>
                            <option value="PI">Piau√≠</option>
                            <option value="RJ">Rio de Janeiro</option>
                            <option value="RN">Rio Grande do Norte</option>
                            <option value="RS">Rio Grande do Sul</option>
                            <option value="RO">Rond√¥nia</option>
                            <option value="RR">Roraima</option>
                            <option value="SC">Santa Catarina</option>
                            <option value="SP" selected>S√£o Paulo</option>
                            <option value="SE">Sergipe</option>
                            <option value="TO">Tocantins</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="cidadeEntrega" class="required">Cidade</label>
                        <input type="text" 
                               id="cidadeEntrega" 
                               name="cidadeEntrega" 
                               th:value="${cidadeEntrega}"
                               placeholder="Nome da cidade">
                    </div>

                    <div class="form-group">
                        <label for="bairroEntrega" class="required">Bairro</label>
                        <input type="text" 
                               id="bairroEntrega" 
                               name="bairroEntrega" 
                               th:value="${bairroEntrega}"
                               placeholder="Nome do bairro">
                    </div>
                </div>

                <div class="form-group">
                    <label for="logradouroEntrega" class="required">Logradouro</label>
                    <input type="text" 
                           id="logradouroEntrega" 
                           name="logradouroEntrega" 
                           th:value="${logradouroEntrega}"
                           placeholder="Rua, Avenida, etc.">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="numeroEntrega" class="required">N√∫mero</label>
                        <input type="text" 
                               id="numeroEntrega" 
                               name="numeroEntrega" 
                               th:value="${numeroEntrega}"
                               placeholder="N¬∫">
                    </div>

                    <div class="form-group">
                        <label for="complementoEntrega">Complemento</label>
                        <input type="text" 
                               id="complementoEntrega" 
                               name="complementoEntrega" 
                               th:value="${complementoEntrega}"
                               placeholder="Apto, Bloco, etc. (opcional)">
                    </div>
                </div>

                <div class="form-group">
                    <label for="apelidoEntrega">Apelido do Endere√ßo</label>
                    <input type="text" 
                           id="apelidoEntrega" 
                           name="apelidoEntrega" 
                           placeholder="Ex: Casa, Trabalho, etc. (opcional)">
                    <small>Opcional - ajuda a identificar o endere√ßo</small>
                </div>
            </div>

            <!-- BOT√ïES -->
            <div class="btn-group">
                <button type="submit" class="btn btn-primary">
                    ‚úÖ Criar Minha Conta
                </button>
                <a href="/cliente/login" class="btn btn-secondary">
                    ‚ùå Cancelar
                </a>
            </div>
        </form>

        <!-- Link para voltar ao login -->
        <div class="back-login">
            <a href="/cliente/login">‚Üê J√° tenho uma conta</a>
        </div>
    </div>

    <script>
        // Valida√ß√£o de Nome Completo
        function validarNome(input) {
            const nome = input.value.trim();
            const validation = document.getElementById('nomeValidation');
            const palavras = nome.split(/\s+/).filter(p => p.length > 0);
            
            if (nome === '') {
                validation.textContent = '';
                input.classList.remove('valid', 'invalid');
                return;
            }
            
            if (palavras.length < 2) {
                validation.textContent = '‚ùå Digite pelo menos 2 palavras';
                validation.className = 'validation-message error';
                input.classList.add('invalid');
                input.classList.remove('valid');
                return;
            }
            
            const palavrasCurtas = palavras.filter(p => p.length < 3);
            if (palavrasCurtas.length > 0) {
                validation.textContent = '‚ùå Cada palavra deve ter pelo menos 3 letras';
                validation.className = 'validation-message error';
                input.classList.add('invalid');
                input.classList.remove('valid');
                return;
            }
            
            validation.textContent = '‚úÖ Nome v√°lido';
            validation.className = 'validation-message success';
            input.classList.add('valid');
            input.classList.remove('invalid');
        }

        // Valida√ß√£o de Email
        function validarEmail(input) {
            const email = input.value.trim();
            const validation = document.getElementById('emailValidation');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (email === '') {
                validation.textContent = '';
                input.classList.remove('valid', 'invalid');
                return;
            }
            
            if (!emailRegex.test(email)) {
                validation.textContent = '‚ùå E-mail inv√°lido';
                validation.className = 'validation-message error';
                input.classList.add('invalid');
                input.classList.remove('valid');
                return;
            }
            
            validation.textContent = '‚úÖ E-mail v√°lido';
            validation.className = 'validation-message success';
            input.classList.add('valid');
            input.classList.remove('invalid');
        }

        // Formatar e Validar CPF
        function formatarValidarCPF(input) {
            let cpf = input.value.replace(/\D/g, '');
            
            // Formatar
            if (cpf.length <= 11) {
                cpf = cpf.replace(/(\d{3})(\d)/, '$1.$2');
                cpf = cpf.replace(/(\d{3})(\d)/, '$1.$2');
                cpf = cpf.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                input.value = cpf;
            }
            
            // Validar
            const validation = document.getElementById('cpfValidation');
            const cpfLimpo = cpf.replace(/\D/g, '');
            
            if (cpfLimpo.length === 0) {
                validation.textContent = '';
                input.classList.remove('valid', 'invalid');
                return;
            }
            
            if (cpfLimpo.length < 11) {
                validation.textContent = '';
                input.classList.remove('valid', 'invalid');
                return;
            }
            
            if (!validarCPF(cpfLimpo)) {
                validation.textContent = '‚ùå CPF inv√°lido';
                validation.className = 'validation-message error';
                input.classList.add('invalid');
                input.classList.remove('valid');
                return;
            }
            
            validation.textContent = '‚úÖ CPF v√°lido';
            validation.className = 'validation-message success';
            input.classList.add('valid');
            input.classList.remove('invalid');
        }

        function validarCPF(cpf) {
            if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
            
            let soma = 0;
            for (let i = 0; i < 9; i++) {
                soma += parseInt(cpf.charAt(i)) * (10 - i);
            }
            let resto = 11 - (soma % 11);
            let digito1 = resto >= 10 ? 0 : resto;
            
            if (parseInt(cpf.charAt(9)) !== digito1) return false;
            
            soma = 0;
            for (let i = 0; i < 10; i++) {
                soma += parseInt(cpf.charAt(i)) * (11 - i);
            }
            resto = 11 - (soma % 11);
            let digito2 = resto >= 10 ? 0 : resto;
            
            return parseInt(cpf.charAt(10)) === digito2;
            }

        // Validar Idade (18 anos)
        function validarIdade(input) {
            const validation = document.getElementById('idadeValidation');
            const dataNasc = new Date(input.value);
            const hoje = new Date();
            
            if (!input.value) {
                validation.textContent = '';
                input.classList.remove('valid', 'invalid');
                return;
            }
            
            let idade = hoje.getFullYear() - dataNasc.getFullYear();
            const mes = hoje.getMonth() - dataNasc.getMonth();
            
            if (mes < 0 || (mes === 0 && hoje.getDate() < dataNasc.getDate())) {
                idade--;
            }
            
            if (idade < 18) {
                validation.textContent = '‚ùå Voc√™ deve ter pelo menos 18 anos';
                validation.className = 'validation-message error';
                input.classList.add('invalid');
                input.classList.remove('valid');
                return;
            }
            
            if (idade > 120) {
                validation.textContent = '‚ùå Data de nascimento inv√°lida';
                validation.className = 'validation-message error';
                input.classList.add('invalid');
                input.classList.remove('valid');
                return;
            }
            
            validation.textContent = '‚úÖ Idade v√°lida';
            validation.className = 'validation-message success';
            input.classList.add('valid');
            input.classList.remove('invalid');
        }

        // Validar Senhas
        function validarSenhas() {
            const senha = document.getElementById('senha').value;
            const confirmar = document.getElementById('confirmarSenha').value;
            const validation = document.getElementById('senhaValidation');
            
            if (confirmar === '') {
                validation.textContent = '';
                document.getElementById('confirmarSenha').classList.remove('valid', 'invalid');
                return;
            }
            
            if (senha !== confirmar) {
                validation.textContent = '‚ùå As senhas n√£o coincidem';
                validation.className = 'validation-message error';
                document.getElementById('confirmarSenha').classList.add('invalid');
                document.getElementById('confirmarSenha').classList.remove('valid');
                return;
            }
            
            if (senha.length < 6) {
                validation.textContent = '‚ùå Senha deve ter no m√≠nimo 6 caracteres';
                validation.className = 'validation-message error';
                document.getElementById('confirmarSenha').classList.add('invalid');
                document.getElementById('confirmarSenha').classList.remove('valid');
                return;
            }
            
            validation.textContent = '‚úÖ Senhas coincidem';
            validation.className = 'validation-message success';
            document.getElementById('confirmarSenha').classList.add('valid');
            document.getElementById('confirmarSenha').classList.remove('invalid');
        }

        // Formatar CEP
        function formatarCep(input) {
            let cep = input.value.replace(/\D/g, '');
            
            if (cep.length <= 8) {
                cep = cep.replace(/(\d{5})(\d)/, '$1-$2');
                input.value = cep;
            }
        }

        // Buscar CEP via API
        function buscarCep(tipo) {
            const cepInput = document.getElementById('cep' + tipo);
            const btn = document.getElementById('btnBuscarCep' + tipo);
            const validation = document.getElementById('cep' + tipo + 'Validation');
            const cep = cepInput.value.replace(/\D/g, '');
            
            if (cep.length !== 8) {
                alert('Digite um CEP v√°lido com 8 d√≠gitos');
                return;
            }
            
            // Desabilita bot√£o e mostra loading
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Buscando...';
            validation.textContent = '';
            
            // Faz requisi√ß√£o
            fetch('/cliente/buscar-cep?cep=' + cep)
                .then(response => response.json())
                .then(data => {
                    if (data.erro) {
                        validation.textContent = '‚ùå CEP n√£o encontrado';
                        validation.className = 'validation-message error';
                    } else {
                        // Preenche os campos
                        document.getElementById('logradouro' + tipo).value = data.logradouro || '';
                        document.getElementById('bairro' + tipo).value = data.bairro || '';
                        document.getElementById('cidade' + tipo).value = data.localidade || '';
                        document.getElementById('estado' + tipo).value = data.uf || '';
                        
                        validation.textContent = '‚úÖ CEP encontrado!';
                        validation.className = 'validation-message success';
                        
                        // Foco no n√∫mero
                        document.getElementById('numero' + tipo).focus();
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    validation.textContent = '‚ùå Erro ao buscar CEP';
                    validation.className = 'validation-message error';
                })
                .finally(() => {
                    btn.disabled = false;
                    btn.innerHTML = 'Buscar CEP';
                });
        }

        // Toggle Copiar Endere√ßo
        function toggleCopiarEndereco() {
            const checkbox = document.getElementById('copiarEndereco');
            checkbox.checked = !checkbox.checked;
            toggleEnderecoEntrega();
        }

        // Mostrar/Ocultar Endere√ßo de Entrega
        function toggleEnderecoEntrega() {
            const checkbox = document.getElementById('copiarEndereco');
            const fields = document.getElementById('enderecoEntregaFields');
            
            if (checkbox.checked) {
                fields.classList.remove('show');
                
                // Remove required dos campos de entrega
                document.querySelectorAll('#enderecoEntregaFields input[required], #enderecoEntregaFields select[required]').forEach(input => {
                    input.removeAttribute('required');
                });
            } else {
                fields.classList.add('show');
                
                // Adiciona required nos campos obrigat√≥rios de entrega
                document.getElementById('cepEntrega').setAttribute('required', 'required');
                document.getElementById('logradouroEntrega').setAttribute('required', 'required');
                document.getElementById('numeroEntrega').setAttribute('required', 'required');
                document.getElementById('bairroEntrega').setAttribute('required', 'required');
                document.getElementById('cidadeEntrega').setAttribute('required', 'required');
                document.getElementById('estadoEntrega').setAttribute('required', 'required');
            }
        }

        // Valida√ß√£o Final do Formul√°rio
        function validarFormulario() {
            let erros = [];
            
            // Validar Nome
            const nome = document.getElementById('nomeCompleto').value.trim();
            const palavras = nome.split(/\s+/).filter(p => p.length > 0);
            
            if (palavras.length < 2) {
                erros.push('Nome completo deve ter pelo menos 2 palavras');
            } else {
                const palavrasCurtas = palavras.filter(p => p.length < 3);
                if (palavrasCurtas.length > 0) {
                    erros.push('Cada palavra do nome deve ter pelo menos 3 letras');
                }
            }
            
            // Validar Email
            const email = document.getElementById('email').value.trim();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                erros.push('E-mail inv√°lido');
            }
            
            // Validar CPF
            const cpf = document.getElementById('cpf').value.replace(/\D/g, '');
            if (!validarCPF(cpf)) {
                erros.push('CPF inv√°lido');
            }
            
            // Validar Idade
            const dataNasc = new Date(document.getElementById('dataNascimento').value);
            const hoje = new Date();
            let idade = hoje.getFullYear() - dataNasc.getFullYear();
            const mes = hoje.getMonth() - dataNasc.getMonth();
            
            if (mes < 0 || (mes === 0 && hoje.getDate() < dataNasc.getDate())) {
                idade--;
            }
            
            if (idade < 18) {
                erros.push('Voc√™ deve ter pelo menos 18 anos para se cadastrar');
            }
            
            // Validar Senhas
            const senha = document.getElementById('senha').value;
            const confirmar = document.getElementById('confirmarSenha').value;
            
            if (senha.length < 6) {
                erros.push('Senha deve ter no m√≠nimo 6 caracteres');
            }
            
            if (senha !== confirmar) {
                erros.push('As senhas n√£o coincidem');
            }
            
            // Validar CEP de Faturamento
            const cepFat = document.getElementById('cepFaturamento').value.replace(/\D/g, '');
            if (cepFat.length !== 8) {
                erros.push('CEP de faturamento inv√°lido');
            }
            
            // Validar CEP de Entrega (se n√£o copiar do faturamento)
            const copiarEndereco = document.getElementById('copiarEndereco').checked;
            if (!copiarEndereco) {
                const cepEnt = document.getElementById('cepEntrega').value.replace(/\D/g, '');
                if (cepEnt.length !== 8) {
                    erros.push('CEP de entrega inv√°lido');
                }
            }
            
            // Exibir erros
            if (erros.length > 0) {
                alert('Corrija os seguintes erros:\n\n‚Ä¢ ' + erros.join('\n‚Ä¢ '));
                return false;
            }
            
            // Confirma√ß√£o final
            return confirm('Confirma o cadastro com os dados informados?');
        }

        // Permite Enter no CEP para buscar
        document.addEventListener('DOMContentLoaded', function() {
            ['cepFaturamento', 'cepEntrega'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            const tipo = id.replace('cep', '');
                            buscarCep(tipo);
                        }
                    });
                }
            });
            
            // Define data m√°xima (hoje) para data de nascimento
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('dataNascimento').setAttribute('max', hoje);
            
            // Define data m√≠nima (120 anos atr√°s)
            const minDate = new Date();
            minDate.setFullYear(minDate.getFullYear() - 120);
            document.getElementById('dataNascimento').setAttribute('min', minDate.toISOString().split('T')[0]);
        });
    </script>
</body>
</html>